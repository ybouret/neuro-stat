\documentclass{revtex4}

\usepackage{graphicx}
\usepackage{amssymb,amsmath}
\usepackage{epstopdf}
\usepackage{bm}
\usepackage{dsfont}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\begin{document}
\title{NeuroCorr}
\maketitle

\section{Data Description}
We have a set of $M$ trials (indexed by $j$) performed on $N$ neurones (indexed by $i$).
Each trial is a set of $N$ trains $\mathcal{T}_{j,i}$ with a
given number of spikes $S_{j,i}$ occuring a times $\tau_{j,i,q}, q\in[1:S_{j,i}]$.
Here, we will assume that the times are integer for a given time scale (millisecond, microsecond, nanosecond...).

\section{Counting interaction function}
\subsection{Description}
An counting interaction function is described by two parameters and acting on any train $\mathcal{T}_z$: a time length $\delta$ and a number
of shifts $k$ ($0\leq k < K$):
$$
	\Phi_{z,k,\delta}(t) = 
	\sum_{u\in\tau_{z}}
	 \mathds{1}_{(t-u)\in\mathbb{I}_k,\mathbb{I}_k=\lbrack k\delta,(k+1)\delta\lbrack}
$$
This expression is the number of points in $\rbrack t-(k+1)\delta,t-k\delta\rbrack$, and all the $\Phi$ functions
are hence right-continuous, constant piecewise functions.
In particular,
$$
	\Phi_{z,k,\delta}(t) = \Phi_{z,0,\delta}(t-k\delta).
$$
so we only need to compute a source function for a given train, and the following functions are computed by just
a shift in the partition.

\subsection{Implementation}
\subsubsection{Description}
We described a CPW function by a list/vector of \textbf{sorted} coordinates $\tau_i,F_i$.
and a '$\mathrm{foot}$' before the first coordinate. If the function has no coordinate, this
is the constant function...with constant value=$\mathrm{foot}$.
In summary, let $F(t)$ be a CPW function with $n_F$  coordinates and a foot value.
\begin{itemize}
	\item if $n_F=0$ then $F(t)\equiv\mathrm{foot}$.
	\item if $n_F>0$ then
	\begin{itemize}
		\item $F(t\leq\tau_0) = \mathrm{foot}$
		\item $F(\tau_{i}<t\leq\tau_{i+1}) = F_i$
		\item $F(t>\tau_{n_F-1})           = F_{n_F-1}$
	\end{itemize}
\end{itemize}

\subsubsection{Algorithm to build the source function}
Mine: Specific List Fusion + doublons removal.

\subsubsection{Evaluation}

\subsubsection{Sum over sorted times}

\subsubsection{Product construction}

\subsubsection{Integration}


\section{Boxes-wise computation}
\subsection{Using boxes}
A box $B$ is described by a trial index $j$ (with its $N$ corresponding trains, one per neurone),
a starting time $\tau_{s}$, a final time $\tau_{f}$, and a biological behaviour $\beta$.

\subsection{Right-hand column-vectors $\mathcal{B}$}
The matrix $\mathcal{B}$ has $N$ columns and $1+NK$ rows.\\
For each neurone $N_{j,i}$, we make a new column $\mathcal{B}_i$.
We start by collection the list $\lambda_{j,i}=\lbrace\tau_{j,i}\in\left[\tau_s,\tau_f\right]\rbrace$,
which is a (shorter) list of sorted times.
\begin{itemize}
\item
The first line is
$$
	\mathcal{B}_{i,0} = \#\lambda_{j,i}
$$
\item
The following lines are defined for each neurone $l$, append the $K$ values
$$
	\mathcal{B}_{i,1+(Kl)+k} = \sum_{\tau\in\lambda_{j,i}} \Phi_{j,l,k,\delta}(\tau)
$$
\end{itemize}

\subsection{Left-hand Matrix $\mathcal{G}$}
The $\mathcal{G}$ matrix has $1+NK$ lines and columns.
\begin{itemize}
	\item 
		$$ 
		\mathcal{G}_{0,0} = \tau_f-\tau_s+1
		$$
	\item for each neuron $i$ the for each index $k$,
		$$
			\mathcal{G}_{0,1+\ldots} =  \int_{\tau_s}^{\tau_f} \Phi_{j,i,k}(\tau) \, \mathrm{d}\tau
		$$
	
	
\end{itemize}

\end{document}
